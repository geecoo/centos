#!/usr/bin/bash

# echo $(dirname $BASH_SOURCE)
BIN_DIR=$(cd `dirname $0`;pwd -P)
ROOT_DIR=$(dirname $BIN_DIR)

# Scripts directory
CONF_DIR="$ROOT_DIR/conf"
LOG_DIR="$ROOT_DIR/log"
SRC_DIR="$ROOT_DIR/src"
TAR_DIR="$ROOT_DIR/storage/tar"

# load config
. ${CONF_DIR}/*

# load functions
. /etc/init.d/functions
. "$SRC_DIR/framework/lib/functions" 
. "$SRC_DIR/framework/lib/argsparser" 

################   Bootstrap loaded completed. ######################

# MODULE        模块名
# MODULE_DIR    模块路径
# DO            执行体名
# DO_SCRIPT     执行体路径

## 解析参数 ##
argsparser $@

## 解析不到， 进入交互系统

if [ ! "$MODULE" ];then
    __echo_warning "The param '-m | --module' could not be found." 
    exit 1
fi

if [ ! "$DO" ];then
    __echo_warning "The param '-d | --do' could not be found." 
    exit 1
fi

MODULE_DIR=$(find ${SRC_DIR}  -maxdepth 1 -type d -name ${MODULE})

if [ ! "$MODULE_DIR" ];then
    __echo_warning "The module '$MODULE' could not be found." 
    exit 1
fi


DO_SCRIPT=$(find ${MODULE_DIR} -type f -name ${DO})

if [ ! "$DO_SCRIPT" ];then
    __echo_warning "The do scirpt '$DO' could not be found." 
    exit 1
fi

#echo "$@"
#exec ${caller_abs_path} "$@" 

echo "MODULE_DIR :" ${MODULE_DIR}
echo "DO_SCRIPT:" ${DO_SCRIPT}
echo "REPLY_YES:" ${REPLY_YES}

time . ${DO_SCRIPT}

